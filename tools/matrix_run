#!/bin/bash

cd $(dirname "$0")
cd ..

module="$1"
module=${module%.py}
target=/Volumes/CIRCUITPY

if [ -z "$module" ]; then
    echo "Usage: $0 <module>"
    echo
    echo "Runs a module on the attached CircuitPython device, using"
    echo "adafruit.rgbmatrix as the graphics driver."
    exit 1
fi

if ! python -c "from $module import run"; then
    exit 1
fi

if [ ! -d "$target" ]; then
    echo "No drive found at $target.  Is a CircuitPython device connected?"
    exit 1
fi

cat <<EOF >code.py
import matrix_frame
frame = matrix_frame.new_display_frame(192, 32, 64)

from $module import run
run(frame)
EOF

command cp *.py $target
